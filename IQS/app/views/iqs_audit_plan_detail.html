
<div class="app-shell">
  
    <div class="main-layout">
        

        <div class="content-area">

            <div id="scroll_content" class="scroll-flex" dx-scroll-view="scroll_content">
                <div class="page-header">
                    <div class="page-title-block">
                        <div class="page-title">
                            Audit Plan – {{ item.auditNo }}
                            <span class="page-title-pill">Internal audit</span>
                        </div>
                        <div class="page-subtitle">
                            Conceptual view showing scope, objectives, findings, corrective actions and linked hazards.
                        </div>
                    </div>
                    <div class="page-actions">
                        <div dx-button="btn_back" class="btn btn-ghost">
                            <span class="icon">←</span>
                            Back
                        </div>
                        <div dx-button="btn_save" class="btn btn-primary">
                            <span class="icon">＋</span>
                            Save
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="form-grid">
                        <div class="form-group full">
                            <label><span class="field-name">Title</span></label>
                            <div class="input" dx-text-box="txt_title" dx-validator="{validationGroup:'auditsave',  validationRules: [{ type: 'required' }]}"></div>
                            <!--<input type="text"  ng-model="item.title" />-->

                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Code</span></label>
                            <div class="input" dx-text-box="txt_code"></div>
                            <!--<input type="text" ng-model="item.dept" />-->
                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Type</span></label>
                            <div class="input" dx-select-box="sb_types"></div>
                            <!--<input type="text" ng-model="item.auditType" />-->
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">IssueDate</span></label>
                            <div class="input" dx-date-box="dt_issue_date"></div>
                            <!--<input type="text" ng-model="item.startDate" />-->
                        </div>

                        <div class="form-group full">
                            <label><span class="field-name">Objective</span></label>
                            <div class="input" dx-text-area="txt_objective"></div>
                            <!--<textarea>{{ item.objective }}</textarea>s-->
                        </div>

                        <div class="form-group full">
                            <label><span class="field-name">Description</span></label>
                            <div class="input" dx-text-area="txt_Description"></div>
                            <!--<textarea>{{ item.standards }}</textarea>-->
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">Lead auditor</span></label>
                            <div dx-select-box="sb_auditors"></div>
                            <!--<input type="text" ng-model="item.leadAuditor" />-->
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="page-subtitle" style="margin-bottom:6px;">Opening meeting</div>
                    <div class="meeting-grid">
                        <div class="form-group">
                            <label><span class="field-name">Start</span></label>
                            <div class="input" dx-date-box="dt_opening_start"></div>
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">End</span></label>
                            <div class="input" dx-date-box="dt_opening_end"></div>
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">Venue</span></label>
                            <div class="input" dx-text-box="txt_opening_venue"></div>
                        </div>
                    </div>

                    <!--<div class="section-head" style="margin: 12px 0px 6px 0px;">
                        <div class="page-subtitle">Audit programme</div>
                        <div dx-button="btn_audit_add" class="btn btn-primary" style="margin-right: 6px ;"  >
                            <span class="icon" >＋</span>
                            Add Audit
                        </div>
                    </div>-->
                    <div class="section-head">
                        <div class="page-subtitle">Audit programme</div>
                        <div dx-button="btn_audit_add" class="btn btn-primary"></div>
                    </div>

                    <div class="audit-list" ng-if="audits && audits.length">
                        <div class="audit-item" ng-repeat="a in audits" ng-click="openAudit(a)">
                            <div class="audit-item-main">
                                <div class="audit-item-title">
                                    <span style="font-weight:600;">{{ a.code }}</span>
                                    <span style="opacity:.75;">—</span>
                                    <span>{{ a.title }}</span>
                                </div>
                                <div class="audit-item-meta">
                                    <span class="tag">{{ a.status || 'Draft' }}</span>
                                    <span class="tag">{{ a.audit_date | date:'yyyy-MM-dd' }}</span>
                                    <span class="tag" ng-if="a.auditee_name">{{ a.auditee_name }}</span>
                                    <span class="tag" ng-if="a.auditor_name">{{ a.auditor_name }}</span>
                                    <span class="tag" ng-if="a.location_title">{{ a.location_title }}</span>
                                </div>
                            </div>
                            <div class="audit-item-open">Open →</div>
                        </div>
                    </div>

                    <div class="hint" ng-if="!audits || !audits.length" style="margin-top:6px;">
                        No planned audits.
                    </div>

<div class="page-subtitle" style="margin:12px 0px 6px 0px;">Closing meeting</div>

                    <div class="meeting-grid">
                        <div class="form-group">
                            <label><span class="field-name">Start</span></label>
                            <div class="input" dx-date-box="dt_closing_start"></div>
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">End</span></label>
                            <div class="input" dx-date-box="dt_closing_end"></div>
                        </div>

                        <div class="form-group">
                            <label><span class="field-name">Venue</span></label>
                            <div class="input" dx-text-box="txt_closing_venue"></div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="card" style="background:none; border:none; padding:0;">
                        <div class="page-subtitle" style="margin-bottom:6px;">Findings</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Title</th>
                                    <th>Level</th>
                                    <th>Auditor</th>
                                    <th>Closure Deadline</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="f in findings">
                                    <td>{{ f.code }}</td>
                                    <td>{{ f.title }}</td>
                                    <td>{{ f.level }}</td>
                                    <td>{{ f.auditor_name }}</td>
                                    <td>{{ f.closure_deadline | date:'yyyy-MM-dd' }}</td>
                                </tr>
                                <tr ng-if="!findings || !findings.length">
                                    <td colspan="5" style="font-size:0.85rem; color:var(--text-muted);">
                                        No findings.
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>

                    <div class="card" style="background:none; border:none; padding:0; margin-top:10px;">
                        <div class="page-subtitle" style="margin-bottom:6px;">Corrective actions &amp; monitoring</div>
                        <!--<p class="hint" style="margin:0 0 6px;">
                            For each finding, this section summarises the agreed corrective action, the responsible owner,
                            target date and how the effectiveness will be monitored.
                        </p>-->
                        <table>
                            <thead>
                                <tr>
                                    <th>Finding no</th>
                                    <th>Corrective action</th>
                                    <th>Owner</th>
                                    <th>Target date</th>
                                    <th>Follow-up / monitoring</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="a in actions">
                                    <td>{{ a.finding_id }}</td>
                                    <td>{{ a.action_title }}</td>
                                    <td>{{ a.responsible_manager_name }}</td>
                                    <td>{{ a.request_implementation_date | date:'yyyy-MM-dd' }}</td>
                                    <td>
                                        <div><strong>Approved:</strong> {{ a.is_approved }}</div>
                                        <div ng-if="a.follow_up1_date"><strong>FU1:</strong> {{ a.follow_up1_date | date:'yyyy-MM-dd' }}</div>
                                        <div ng-if="a.follow_up2_date"><strong>FU2:</strong> {{ a.follow_up2_date | date:'yyyy-MM-dd' }}</div>
                                    </td>
                                </tr>
                                <tr ng-if="!actions || !actions.length">
                                    <td colspan="5" style="font-size:0.85rem; color:var(--text-muted);">
                                        No corrective actions.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-divider"></div>

                    <div class="card" style="background:none; border:none; padding:0;">
                        <div class="page-subtitle" style="margin-bottom:6px;">Linked hazards</div>
                        <p class="hint" style="margin:0 0 6px;">
                            Hazards that are either the subject of the audit or are directly affected by its findings.
                        </p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Hazard code</th>
                                    <th>Title</th>
                                    <th>Risk (initial → residual)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="h in hazards">
                                    <td>{{ h.code }}</td>
                                    <td>{{ h.title }}</td>
                                    <td>{{ h.initialRisk }} → {{ h.residualRisk }}</td>
                                </tr>
                                <tr ng-if="!hazards.length">
                                    <td colspan="3" style="font-size:0.85rem; color:var(--text-muted);">
                                        No hazards linked in this demo.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!--<div class="footer">
            <span><strong>Note:</strong> All content is fictitious and for concept/demo only.</span>
            <span class="link-muted" ng-click="shell.go('/hazards')">Back to hazard register</span>
        </div>-->
    </div>
</div>





